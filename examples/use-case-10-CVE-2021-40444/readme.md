This use case aims to partially simulate the server side component of an "in-the-wild-spotted" Office sample which exploits CVE-2021-40444 (MSHTML Remote Code Execution Vulnerability)  

These samples were spotted by Twitter user @ShadowChasing1 in this tweet: https://twitter.com/ShadowChasing1/status/1433252128106029061. The files hosted on the attackers server were kindly archived for research purposes by Twitter user @JAMESWT_MHT in this tweet: https://twitter.com/JAMESWT_MHT/status/1433282944156815361  

At the time of this writing, I did not immediately find public sources which allowed me to replicate the full attack chain. The publicly mentioned samples shared on 8-9 September 2021 all connected to a domain which was taken offline. In order to research the behavior triggered by this attack vector, I decided to simulate the server side component based on publicly available data. Maybe this can work help some other defense researchers too :-).

!!!This simulation involves running malware. Only do this in a sandbox environment and if you know what you are doing!!!

Use Case description
---------------------
Imaginary C2 can be used to simulate the hosting of hidusi[.]com server used in the CVE-2021-40444 attack of the below sample.
Additional info can be found on this blog: https://www.trendmicro.com/en_us/research/21/i/remote-code-execution-zero-day--cve-2021-40444--hits-windows--tr.html

![MSHTML exploit example](../../media/imaginary_c2_CVE-2021-40444.GIF?raw=true) 


Use Case prerequisites 
-----------------------
*This use case should be used in conjunction with the following Office sample:  
  * MD5: 1d2094ce85d66878ee079185e2761beb  
  * SHA1: 53b31e513d8e23e30b7f133d4504ca7429f0e1fe  
  * SHA256: 938545f7bbe40738908a95da8cdeabb2a11ce2ca36b0f6a74deda9378d380a52  

*This use case has been tested on a Windows 10 64-bit virtual machine, with python 2.7 installed. I ran the sample with an Office 2019 installation.

How to run
----------
*Ensure you are in a sandbox environment (e.g. virtual throwaway machine) and have python 2.7 installed  
*Copy the redirect_config.txt and requests_config.txt to imaginary C2's folder  
*Copy the files in server_data to imaginary C2's server_data folder  
*Run imaginary C2's redirect_to_imaginary_c2.bat file (as administrator)  
*(Optionally: disable your network adapter, no internet connectivity is needed since Imaginary C2 simulates everything)  
*Run imaginary C2's launch_imaginary_c2_server.bat  
*Run the sample (SHA1 above). The sample can be found inside the "use-case-samples.zip" file in this repository (password=infected)
*If all works correctly, you will see something like:
-Office (Windword.exe) spawning control.exe
-Control.exe example CMDlines: 
C:\Windows\SysWOW64\control.exe ".cpl:123",
C:\Windows\SysWOW64\control.exe ".cpl:../../../AppData/Local/Temp/championship.inf",
-Control.exe spawning rundll32. Example cmdline:
"C:\WINDOWS\system32\rundll32.exe" Shell32.dll,Control_RunDLL ".cpl:../../../AppData/Local/Temp/championship.inf",



